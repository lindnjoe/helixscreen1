# Hidden Tests Tracker

**Last Updated:** 2026-01-08
**Total Hidden Tests:** 28 (+ 1 unhidden test that hangs)
**Generated by:** Analyzing `[.]` tags in `tests/unit/*.cpp`

## Recently Fixed (2026-01-08)

- **MockPrint fixture destruction** (2 tests in test_mock_print_simulation.cpp)
  - Added condition_variable synchronization to MoonrakerClientMock temperature simulation
  - Thread now exits promptly on shutdown instead of waiting for sleep to complete

- **HelixMacroManager fixture tests** (6 tests in test_helix_macro_manager.cpp)
  - Tests were already passing - fixture doesn't use temperature simulation
  - Removed hidden tags to re-enable in normal test runs

- **Theme constants parallel isolation** - Fixed race condition in `test_ui_theme_constants.cpp`
  where multiple parallel shards used the same temp directory. Now uses PID-unique paths.

---

## Overview

Hidden tests are excluded from normal test execution using Catch2's hidden tag mechanism (`[.]` prefix). They exist for various reasons:

- **Crashes/Instability**: Tests that cause crashes (SIGILL, SIGSEGV) during cleanup
- **External Dependencies**: Tests requiring live connections or hardware
- **Mock Limitations**: Tests blocked by incomplete mock implementations
- **Performance**: Tests too slow for normal CI runs
- **UI Integration**: Tests requiring full LVGL initialization

**Running hidden tests:**
```bash
# Run all hidden tests
./build/bin/helix-tests "[.]"

# Run by category
./build/bin/helix-tests "[.ui_integration]"
./build/bin/helix-tests "[.needs_mock_extension]"
./build/bin/helix-tests "[.benchmark]"
./build/bin/helix-tests "[.slow]"
```

---

## Summary Statistics

| Tag | Count | Description |
|-----|-------|-------------|
| `[.]` | 8 | Generic hidden (crashes, instability) |
| `[.ui_integration]` | 8 | Requires full LVGL/XML setup |
| `[.needs_mock_extension]` | 7 | Blocked by mock limitations |
| `[.network]` | 1 | Requires network connection |
| `[.integration]` | 1 | Requires external service |
| `[.benchmark]` | 1 | Performance measurement |
| `[.slow]` | 1 | Too slow for CI |
| `[.disabled]` | 1 | Temporarily disabled |

**By Priority:**
- HIGH (blocks important testing): 9
- MEDIUM (reduces coverage): 11
- LOW (working as designed): 8

---

## Hidden Test Inventory

### G-code Geometry Tests (2 tests)

| File | Line | Test | Tags | Issue |
|------|------|------|------|-------|
| `test_gcode_geometry_builder.cpp` | 154 | RibbonGeometry construction | `[gcode][geometry][ribbon][.]` | `normal_cache_ptr` is nullptr |
| `test_gcode_geometry_builder.cpp` | 166 | RibbonGeometry move semantics | `[gcode][geometry][ribbon][.]` | Cache nullptr after move |

**Priority:** MEDIUM
**Root Cause:** Cache initialization issue; move constructor doesn't transfer ownership
**Fix Approach:** Use unique_ptr for cache pointers; fix move semantics

---

### Input Shaper API Tests (7 tests)

| File | Line | Test | Tags | Issue |
|------|------|------|------|-------|
| `test_moonraker_api_input_shaper.cpp` | 107 | Test 1 | `[.needs_mock_extension]` | Mock can't simulate G-code responses |
| `test_moonraker_api_input_shaper.cpp` | 114 | Test 2 | `[.needs_mock_extension]` | Same |
| `test_moonraker_api_input_shaper.cpp` | 120 | Test 3 | `[.needs_mock_extension]` | Same |
| `test_moonraker_api_input_shaper.cpp` | 133 | Test 4 | `[.needs_mock_extension]` | Same |
| `test_moonraker_api_input_shaper.cpp` | 138 | Test 5 | `[.needs_mock_extension]` | Same |
| `test_moonraker_api_input_shaper.cpp` | 143 | Test 6 | `[.needs_mock_extension]` | Same |
| `test_moonraker_api_input_shaper.cpp` | 245 | Edge cases | `[.needs_mock_extension]` | Same |

**Priority:** HIGH (blocks Input Shaper feature testing)
**Root Cause:** `MoonrakerClientMock` doesn't implement `register_gcode_response_handler()`
**Fix Approach:** Extend mock to support `notify_gcode_response` event simulation

---

### Exclude Object API Tests (1 test)

| File | Line | Test | Tags | Issue |
|------|------|------|------|-------|
| `test_moonraker_api_exclude_object.cpp` | 169 | Injection security | `[moonraker][security][injection][.]` | Unknown |

**Priority:** MEDIUM
**Root Cause:** Needs investigation
**Fix Approach:** TBD

---

### Moonraker Client Robustness Tests (4 tests)

| File | Line | Test | Tags | Issue |
|------|------|------|------|-------|
| `test_moonraker_client_robustness.cpp` | 97 | Concurrent sends | `[.][concurrent][priority1]` | Mutex lock failed during cleanup |
| `test_moonraker_client_robustness.cpp` | 252 | Concurrent callback registration | `[.slow][concurrent][priority1]` | **HANGS** - thread.join() never returns |
| `test_moonraker_client_robustness.cpp` | 617 | State machine | `[.][state][priority4]` | `send_jsonrpc` returns -1 when disconnected |
| `test_moonraker_client_robustness.cpp` | 887 | Sustained stress | `[.slow]` | Takes 10+ seconds (by design) |

**Priority:** HIGH (concurrent), MEDIUM (state), LOW (stress)
**Root Cause:** Race condition in cleanup; callback registration deadlock; behavior change; performance test
**Fix Approach:** Atomic flags for cleanup sync; investigate callback vector locking; review expected behavior; run manually
**Note:** Line 252 test causes `make test-run` to hang indefinitely - needs `[.]` tag or fix

---

### Moonraker Client Security Tests (2 tests)

| File | Line | Test | Tags | Issue |
|------|------|------|------|-------|
| `test_moonraker_client_security.cpp` | 364 | Timeout callbacks | `[.integration]` | Requires live WebSocket |
| `test_moonraker_client_security.cpp` | 812 | Security properties | `[.][integration]` | SIGSEGV during destruction |

**Priority:** HIGH
**Root Cause:** Needs live connection; callback cleanup race
**Fix Approach:** Mock WebSocket server; fix destructor cleanup

---

### G-code Data Source Tests (1 test)

| File | Line | Test | Tags | Issue |
|------|------|------|------|-------|
| `test_gcode_data_source.cpp` | 226 | MoonrakerDataSource construction | `[.network]` | Requires network |

**Priority:** LOW
**Root Cause:** By design - integration test
**Fix Approach:** Run explicitly when testing network features

---

### WiFi Manager Tests (1 test)

| File | Line | Test | Tags | Issue |
|------|------|------|------|-------|
| `test_wifi_manager.cpp` | 556 | Network information | `[.disabled]` | `scan_once()` returns before completion |

**Priority:** MEDIUM
**Root Cause:** Async API doesn't wait for scan completion
**Fix Approach:** Rewrite with callback pattern or explicit wait

---

### Wizard Connection UI Tests (8 tests)

| File | Line | Test | Tags |
|------|------|------|------|
| `test_wizard_connection_ui.cpp` | 126 | All widgets exist | `[.ui_integration]` |
| `test_wizard_connection_ui.cpp` | 142 | Input field interaction | `[.ui_integration]` |
| `test_wizard_connection_ui.cpp` | 172 | Test button state | `[.ui_integration]` |
| `test_wizard_connection_ui.cpp` | 185 | Status label updates | `[.ui_integration]` |
| `test_wizard_connection_ui.cpp` | 209 | Navigation buttons | `[.ui_integration]` |
| `test_wizard_connection_ui.cpp` | 227 | Title and progress | `[.ui_integration]` |
| `test_wizard_connection_ui.cpp` | 332 | Input validation feedback | `[.ui_integration]` |
| `test_wizard_connection_ui.cpp` | 380 | Responsive layout | `[.ui_integration]` |

**Priority:** MEDIUM
**Root Cause:** XML components not registered; LVGL filesystem driver not set up
**Fix Approach:** Initialize full LVGL + XML in test fixture

---

### Wizard Connection Performance (1 test)

| File | Line | Test | Tags | Issue |
|------|------|------|------|-------|
| `test_wizard_connection.cpp` | 327 | Performance benchmark | `[.benchmark]` | Runs 10000 iterations |

**Priority:** LOW (working as designed)
**Root Cause:** Performance test, excluded from fast CI
**Fix Approach:** Run explicitly: `./build/bin/helix-tests "[.benchmark]"`

---

## Standardized Hidden Tag Conventions

| Tag | Meaning | When to Use |
|-----|---------|-------------|
| `[.]` | Generic hidden | Crashes, instability, catch-all |
| `[.needs_mock_extension]` | Mock limitations | Test blocked by incomplete mock |
| `[.ui_integration]` | Requires UI infrastructure | Needs full LVGL/XML initialization |
| `[.integration]` | Requires external resources | Live server, hardware, etc. |
| `[.network]` | Requires network | Network-dependent tests |
| `[.benchmark]` | Performance measurement | Timing-sensitive, slow |
| `[.slow]` | Too slow for normal runs | >5 seconds execution |
| `[.disabled]` | Temporarily disabled | Awaiting fix or decision |
| `[.flaky]` | Intermittent failures | Race conditions, timing |

---

## Action Items (Prioritized)

### HIGH Priority

1. **Extend MoonrakerClientMock** (7 tests)
   - Add `register_gcode_response_handler()` support
   - Simulate `notify_gcode_response` events
   - Unblocks Input Shaper, Screws Tilt testing

2. **Fix Moonraker client robustness issues** (2 tests)
   - Concurrent sends mutex lock failure during cleanup
   - Security properties SIGSEGV during destruction

### MEDIUM Priority

3. **Fix G-code geometry cache issues** (2 tests)
4. **Set up UI integration test infrastructure** (8 tests)
5. **Fix WiFi scan_once() async behavior** (1 test)

### LOW Priority

6. **Document slow/benchmark tests** - working as designed
7. **Review state machine test expectations** - may need behavior update

---

## Verification Command

Run this to verify document accuracy:
```bash
echo "Hidden tests:" && grep -rn '\[\.' tests/unit/*.cpp | grep -v '^ *//' | grep -v 'Run tests' | wc -l
```

Expected output: `28`
