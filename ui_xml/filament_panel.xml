<?xml version="1.0"?>
<!-- Copyright (C) 2025-2026 356C LLC -->
<!-- SPDX-License-Identifier: GPL-3.0-or-later -->
<component>
  <!-- Styles for reactive purge button state binding (L040: no inline bg attrs) -->
  <styles>
    <style name="purge_btn_selected" bg_color="#primary" bg_opa="255"/>
    <style name="purge_btn_unselected" bg_color="#primary" bg_opa="40"/>
  </styles>
  <!-- Filament Management Panel -->
  <!-- Two-column layout: left (temp status + AMS), right (material + operations) -->
  <view name="filament_panel"
        extends="lv_obj" width="100%" height="100%" style_border_width="0" style_pad_all="#space_lg" scrollable="false"
        flex_flow="row" style_flex_cross_place="start" style_pad_gap="#space_lg" style_bg_color="#screen_bg">
    <!-- ================================================================== -->
    <!-- LEFT COLUMN: Temperature Status & AMS                              -->
    <!-- ================================================================== -->
    <lv_obj name="left_column"
            width="40%" height="100%" style_pad_all="0" scrollable="false"
            flex_flow="column" style_flex_main_place="space_between" style_pad_gap="#space_lg">
      <!-- TOP GROUP: Temperature displays -->
      <lv_obj name="temp_group"
              width="100%" height="content" style_pad_all="0" scrollable="false"
              flex_flow="column" style_flex_main_place="start" style_pad_gap="#space_lg">
        <!-- Temperature Status Card - shows both nozzle and bed -->
        <ui_card name="temp_status_card"
                 width="100%" height="content" style_radius="#border_radius" style_pad_all="#space_lg"
                 flex_flow="column" style_flex_main_place="start" style_flex_cross_place="start"
                 style_pad_gap="#space_md">
          <!-- Header -->
          <text_body text="Temperature" align="left_mid"/>
          <!-- Nozzle Row: Current / Target (entire row tappable) -->
          <lv_obj width="100%"
                  height="content" style_pad_all="0" scrollable="false"
                  flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center" clickable="true">
            <event_cb trigger="clicked" callback="on_filament_nozzle_target_tap"/>
            <text_small text="Nozzle" clickable="false" event_bubble="true"/>
            <lv_obj width="content"
                    height="content" flex_flow="row" style_pad_all="0"
                    scrollable="false" style_flex_cross_place="center" style_pad_gap="#space_xs" clickable="false"
                    event_bubble="true">
              <text_body name="nozzle_current_temp"
                         bind_text="filament_nozzle_current" clickable="false" event_bubble="true"/>
              <text_body text="/" clickable="false" event_bubble="true"/>
              <lv_obj name="nozzle_target_tap"
                      width="content" height="content" style_pad_all="#space_xs"
                      scrollable="false" flex_flow="row" style_flex_cross_place="center" style_pad_gap="#space_xs"
                      clickable="false" event_bubble="true">
                <text_body name="nozzle_target_temp"
                           bind_text="filament_nozzle_target" clickable="false" event_bubble="true"/>
                <icon src="pencil" size="xs" variant="secondary" clickable="false" event_bubble="true"/>
              </lv_obj>
            </lv_obj>
          </lv_obj>
          <!-- Bed Row: Current / Target (entire row tappable) -->
          <lv_obj width="100%"
                  height="content" style_pad_all="0" scrollable="false"
                  flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center" clickable="true">
            <event_cb trigger="clicked" callback="on_filament_bed_target_tap"/>
            <text_small text="Bed" clickable="false" event_bubble="true"/>
            <lv_obj width="content"
                    height="content" flex_flow="row" style_pad_all="0"
                    scrollable="false" style_flex_cross_place="center" style_pad_gap="#space_xs" clickable="false"
                    event_bubble="true">
              <text_body name="bed_current_temp" bind_text="filament_bed_current" clickable="false" event_bubble="true"/>
              <text_body text="/" clickable="false" event_bubble="true"/>
              <lv_obj name="bed_target_tap"
                      width="content" height="content" style_pad_all="#space_xs"
                      scrollable="false" flex_flow="row" style_flex_cross_place="center" style_pad_gap="#space_xs"
                      clickable="false" event_bubble="true">
                <text_body name="bed_target_temp" bind_text="filament_bed_target" clickable="false" event_bubble="true"/>
                <icon src="pencil" size="xs" variant="secondary" clickable="false" event_bubble="true"/>
              </lv_obj>
            </lv_obj>
          </lv_obj>
          <!-- Status Indicator (icon + text row) -->
          <lv_obj width="100%"
                  height="content" style_pad_all="0" scrollable="false"
                  flex_flow="row" style_flex_main_place="start" style_flex_cross_place="center"
                  style_pad_gap="#space_xs">
            <icon name="status_icon" src="info" size="xs" variant="secondary"/>
            <text_small name="status_text" bind_text="filament_status"/>
          </lv_obj>
        </ui_card>
        <!-- Temperature Graph Card (combined nozzle + bed) -->
        <ui_card name="temp_graph_card"
                 width="100%" height="120" style_radius="#border_radius" style_pad_all="#space_xs">
          <!-- Graph container - populated by C++ via TempControlPanel -->
          <lv_obj name="temp_graph_container"
                  width="100%" height="100%" style_pad_all="0"/>
        </ui_card>
      </lv_obj>
      <!-- BOTTOM: AMS Multi-Filament Card (hidden if no AMS) -->
      <ui_card name="ams_status_card"
               width="100%" flex_grow="1" style_radius="#border_radius" style_pad_all="#space_md" flex_flow="column"
               style_flex_main_place="start" style_flex_cross_place="center" style_pad_gap="#space_sm">
        <bind_flag_if_eq subject="ams_type" flag="hidden" ref_value="0"/>
        <!-- Header row with icon -->
        <lv_obj width="100%"
                height="content" style_pad_all="0" scrollable="false"
                flex_flow="row" style_flex_main_place="start" style_flex_cross_place="center" style_pad_gap="#space_sm">
          <icon src="filament" size="sm" variant="secondary"/>
          <text_body text="Multi-Filament" style_translate_y="2"/>
        </lv_obj>
        <!-- AMS mini status + Manage button row -->
        <lv_obj width="100%"
                flex_grow="1" style_pad_all="0" scrollable="false"
                flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center"
                style_pad_gap="#space_sm">
          <!-- AMS mini status (auto-binds to AmsState, fills parent) -->
          <ams_mini_status flex_grow="1"/>
          <!-- Manage Button -->
          <ui_button name="btn_manage_slots"
                     width="content" text="Manage"
                     style_pad_left="#space_md" style_pad_right="#space_md">
            <event_cb trigger="clicked" callback="filament_manage_slots_cb"/>
          </ui_button>
        </lv_obj>
      </ui_card>
    </lv_obj>
    <!-- ================================================================== -->
    <!-- RIGHT COLUMN: Material Selection & Actions                        -->
    <!-- ================================================================== -->
    <lv_obj name="right_column"
            width="58%" height="100%" style_pad_all="0" scrollable="false"
            style_layout="flex" style_flex_flow="column" style_flex_main_place="space_between" style_pad_gap="#space_sm">
      <!-- TOP GROUP: Material Selection + Selected Temps (grouped as one flex child) -->
      <lv_obj name="material_group"
              width="100%" height="content" style_pad_all="0" scrollable="false"
              flex_flow="column" style_pad_gap="#space_md">
        <!-- Material Selection Header -->
        <text_body text="Material" align="left_mid"/>
        <!-- Material Preset Buttons (2x2 Grid: PLA, PETG, ABS, TPU) -->
        <lv_obj name="preset_grid"
                width="100%" height="content" style_pad_all="0"
                scrollable="false" flex_flow="column" style_flex_main_place="start" style_flex_cross_place="center"
                style_pad_gap="#space_sm">
          <!-- Row 1: PLA, PETG -->
          <lv_obj width="100%"
                  height="content" style_pad_all="0" scrollable="false"
                  flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center"
                  style_pad_gap="#space_md">
            <ui_button name="preset_pla" height="content" flex_grow="1" text="PLA" state_trickle="true">
              <event_cb trigger="clicked" callback="on_filament_preset_pla"/>
              <text_small width="100%" text="210°C / 60°C" style_text_align="center"
                          style_text_color="#text_muted" style_text_color:checked="#text"/>
            </ui_button>
            <ui_button name="preset_petg" height="content" flex_grow="1" text="PETG" state_trickle="true">
              <event_cb trigger="clicked" callback="on_filament_preset_petg"/>
              <text_small width="100%" text="240°C / 80°C" style_text_align="center"
                          style_text_color="#text_muted" style_text_color:checked="#text"/>
            </ui_button>
          </lv_obj>
          <!-- Row 2: ABS, TPU -->
          <lv_obj width="100%"
                  height="content" style_pad_all="0" scrollable="false"
                  flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center"
                  style_pad_gap="#space_md">
            <ui_button name="preset_abs" height="content" flex_grow="1" text="ABS" state_trickle="true">
              <event_cb trigger="clicked" callback="on_filament_preset_abs"/>
              <text_small width="100%" text="250°C / 100°C" style_text_align="center"
                          style_text_color="#text_muted" style_text_color:checked="#text"/>
            </ui_button>
            <ui_button name="preset_tpu" height="content" flex_grow="1" text="TPU" state_trickle="true">
              <event_cb trigger="clicked" callback="on_filament_preset_tpu"/>
              <text_small width="100%" text="230°C / 50°C" style_text_align="center"
                          style_text_color="#text_muted" style_text_color:checked="#text"/>
            </ui_button>
          </lv_obj>
        </lv_obj>
        <!-- Cooldown Button (visible when heating) -->
        <ui_button name="btn_cooldown"
                   width="100%" height="#button_height"
                   style_bg_color="#temp_gradient_cold" icon="cooldown" text="Cool Down">
          <bind_flag_if_eq subject="filament_nozzle_heating" flag="hidden" ref_value="0"/>
          <event_cb trigger="clicked" callback="on_filament_cooldown"/>
        </ui_button>
      </lv_obj>
      <!-- BOTTOM GROUP: Operations (second flex child, pushed to bottom by space_between) -->
      <lv_obj name="operations_group"
              width="100%" height="content" style_pad_all="0" scrollable="false"
              flex_flow="column" style_pad_gap="#space_sm">
        <!-- Filament Operations Header -->
        <text_body text="Operations" align="left_mid"/>
        <!-- Purge Amount Selector -->
        <lv_obj name="purge_amount_row"
                width="100%" height="content" style_pad_all="0"
                scrollable="false" flex_flow="row" style_flex_main_place="start" style_flex_cross_place="center"
                style_pad_gap="#space_sm">
          <text_small text="Length:"/>
          <ui_button name="purge_5mm"
                     height="#button_height_sm" flex_grow="1" text="5mm">
            <!-- L040: TWO bind_styles (selected/unselected) with boolean subject -->
            <bind_style name="purge_btn_selected" subject="filament_purge_5mm_active" ref_value="1"/>
            <bind_style name="purge_btn_unselected" subject="filament_purge_5mm_active" ref_value="0"/>
            <event_cb trigger="clicked" callback="on_filament_purge_5mm"/>
          </ui_button>
          <ui_button name="purge_10mm"
                     height="#button_height_sm" flex_grow="1" text="10mm">
            <!-- L040: TWO bind_styles (selected/unselected) with boolean subject -->
            <bind_style name="purge_btn_selected" subject="filament_purge_10mm_active" ref_value="1"/>
            <bind_style name="purge_btn_unselected" subject="filament_purge_10mm_active" ref_value="0"/>
            <event_cb trigger="clicked" callback="on_filament_purge_10mm"/>
          </ui_button>
          <ui_button name="purge_25mm"
                     height="#button_height_sm" flex_grow="1" text="25mm">
            <!-- L040: TWO bind_styles (selected/unselected) with boolean subject -->
            <bind_style name="purge_btn_selected" subject="filament_purge_25mm_active" ref_value="1"/>
            <bind_style name="purge_btn_unselected" subject="filament_purge_25mm_active" ref_value="0"/>
            <event_cb trigger="clicked" callback="on_filament_purge_25mm"/>
          </ui_button>
        </lv_obj>
        <!-- Action Buttons: Load/Unload side-by-side, Purge below -->
        <lv_obj name="action_buttons"
                width="100%" height="content" style_pad_all="0"
                scrollable="false" flex_flow="column" style_flex_main_place="start" style_flex_cross_place="center"
                style_pad_gap="#space_sm">
          <!-- Load/Unload Row -->
          <lv_obj width="100%"
                  height="#button_height" style_pad_all="0" scrollable="false"
                  flex_flow="row" style_flex_main_place="space_between" style_flex_cross_place="center"
                  style_pad_gap="#space_sm">
            <ui_button name="btn_load"
                       height="#button_height" flex_grow="1" icon="arrow_down" text="Load">
              <bind_state_if_eq subject="filament_safety_warning_visible" state="disabled" ref_value="1"/>
              <event_cb trigger="clicked" callback="on_filament_load"/>
            </ui_button>
            <ui_button name="btn_unload"
                       height="#button_height" flex_grow="1" icon="arrow_up" text="Unload">
              <bind_state_if_eq subject="filament_safety_warning_visible" state="disabled" ref_value="1"/>
              <event_cb trigger="clicked" callback="on_filament_unload"/>
            </ui_button>
          </lv_obj>
          <!-- Purge Button -->
          <ui_button name="btn_purge"
                     width="100%" height="#button_height" icon="filament" text="Purge">
            <bind_state_if_eq subject="filament_safety_warning_visible" state="disabled" ref_value="1"/>
            <event_cb trigger="clicked" callback="on_filament_purge"/>
          </ui_button>
        </lv_obj>
        <!-- Safety Warning (compact inline - shows when cold) -->
        <lv_obj name="safety_warning"
                width="100%" height="content" style_pad_all="0"
                scrollable="false" flex_flow="row" style_flex_main_place="start" style_flex_cross_place="center"
                style_flex_track_place="center" style_pad_gap="#space_xs">
          <bind_flag_if_eq subject="filament_safety_warning_visible" flag="hidden" ref_value="0"/>
          <icon src="alert" size="sm" variant="warning"/>
          <text_small bind_text="filament_safety_warning_text"/>
        </lv_obj>
      </lv_obj>
    </lv_obj>
  </view>
</component>
